\section{Комплекс программ для генерации потоков ошибок на основе скрытых полумаковских моделей.} \label{chapt2_Implementation}
В этом разделе представлено описание и особенности реализации программного комплекса для генерации потоков ошибок на основе моделей источников ошибок, описанных в разделах \ref{chapt2_Ferguson} и \ref{chapt2_HSMQPN}.

\subsection{Описание программного комплекса.}
Для генерации потоков ошибок скрытой полумарковской $QP$-моделью и скрытой полумарковской моделью Фергюсоновского типа, описанными в разделах \ref{chapt2_HSMQPN} и \ref{chapt2_Ferguson} соответственно, разработан специальный комплекс программ \textbf{HsmmErrorSourcesGeneration}. Основной задачей этого програмного комплекса является предоставление исследователю возможности осуществлять генерацию последовательностей ошибок в соответствии с заданными в виде текстового файла параметрами модели источника ошибок и алгоритмом генерации для модели заданного типа. Полученные на выходе текстовые файлы, содержащие сгенерированные последовательности, могут использоваться исследователем для самостоятельного анализа.

Программный комплекс \textbf{HsmmErrorSourcesGeneration} реализован на языке программирования высокого уровня $C\sharp$. Необходимым условием для работы программного продукта является наличие .NET Framework 4.0. В основе архитектуры комплекса лежат принципы объектно-ориентированного дизайна.

На рисунке \ref{fig:chapt2_GenerationDFD} представлена диаграмма потоков данных программного комплекса \textbf{HsmmErrorSourcesGeneration}.

\begin{center}\label{fig:chapt2_GenerationDFD}
\includegraphics[height=100mm]{/part2/GenerationDFD.pdf}

Рис.2.4.1.1. Диаграмма потоков данных программного комплекса \textbf{HsmmErrorSourcesGeneration}.
\end{center}

Дадим следующие необходимые пояснения. Пользователь комплекса, которым является исследователь моделей источников ошибок,  задает необходимые параметры генерации, а именно, имя файла, содержащего описание модели; код (идентификатор) генератора случайных чисел; длину выходной последовательности ошибок; имя файла, в который должна быть записана выходная последовательность. Имена файлов могут задаваться как в виде абсолютного, так и в виде относительного пути. Программный комплекс поддерживает три типа генераторов случайных чисел, подробнее о которых будет говориться ниже.

Введенные пользователем параметры передаются подсистеме "Интерфейс пользователя" (Подсистема 1), которая обрабатывает их и обращается к файловой системе для получения содержимого файла с описанием модели источника ошибок, которое для удобства представлено в виде JSON-объекта. Полученный JSON-объект модели, а также данные о типе генератора случайных чисел и длине последовательности Подсистема 1 передает подсистеме управления генерацией последовательности ошибок (Подсистема 2).

Подсистема 2 делает запрос к подсистеме сериализации/десериализации JSON-объектов модели (Подсистема 3), чтобы получить представление модели источника ошибок нужного типа в виде объекта в памяти, после чего передает этот объект подсистеме валидации модели ошибок (Подсистема 4).

Подсистема валидации модели ошибок проверяет корректность заданных параметров модели с точки зрения консистентности и выполнения всех необходимых условий. По окончанию проверки она возвращает Подсистеме 2 результат валидации, содержащий список возникших при валидации модели ошибок.

В случае, если модель задана корректно, результат валидации содержит пустой список ошибок. В этом случае подсистема управления генерацией передает объект модели источника ошибок и длину выходной последовательности подсистеме генерации последовательности ошибок (Подсистема 5) и получает обратно результат генерации, содержащий список возникших ошибок и, в случае их отсутствия, успешно сгенерированную последовательность. Объект результата генерации передается в Подсистему 1.

В случае, если модель задана некорректно Подсистема 2 формирует на основе результата валидации объект результата генерации, содержащий список ошибок валидации и передает его в Подсистему 1.

В Подсистеме 1 производится анализ полученного результата генерации. В случае, если список ошибок генерации не пуст, список возникших ошибок выводится на экран. Если же ошибок не возникло, то сгенерированная последовательность записывается в текстовый файл, указанный пользователем и на экран выводится сообщение об успешном завершении генерации.

\subsection{Структура программного комплекса.}

Структурно программный комплекс состоит из нескольких, логически разделенных модулей. Оболочкой программного комплекса является консольное приложение \textbf{HsmmErrorSources.GenerationApp}, предоставляющее пользователю простейший интерфейс для задания параметров генерации и ее запуска. Параметрами генерации выступают путь к файлу, содержащему описание модели источника ошибок, длина генерируемой последовательности, тип генератора случайных чисел и путь к выходному файлу, в который будет записана последовательность ошибок.

Логическая часть программного комплекса отделена от интерфейса и вынесена в следующие потенциально переиспользуемые модули, оформленные в виде DLL-библиотек: \textbf{HsmmErrorSources.Models} и \textbf{HsmmErrorSources.Generation}. Модуль \textbf{HsmmErrorSources.Models} включает в себя классы, относящиеся к описанию, представлению и валидации моделей источников ошибок. Модуль \textbf{HsmmErrorSources.Generation} содержит классы, реализующие процесс генерации последовательностей ошибок. Такое разделение обусловлено тем, что структуры и алгоритмы из \textbf{HsmmErrorSources.Models} могут быть использованы не только в контексте генерации потоков ошибок, но так же и в решении других задач, например, анализа моделей (см. раздел \ref{chapt3_Implementation}).

Отдельно следует отметить также два модуля \textbf{HsmmErrorSources.Models.Test} и \textbf{HsmmErrorSources.Generation.Test}, содержащих модульные тесты для классов из модулей \textbf{HsmmErrorSources.Models} и \textbf{HsmmErrorSources.Generation} соответственно.

На рисунке \ref{fig:chapt2_DLLDependencies} представлена диаграмма зависимостей модулей программного комплекса \textbf{HsmmErrorSources.Generation}. Здесь зеленая стрелка от модуля A к модулю B говорит о том, что какие-то из классов модуля A наследуют от классов модуля B, розовая стрелка от модуля A к модулю B означает, что в классах модуля A происходит вызов классов из модуля B.
\begin{center}\label{fig:chapt2_DLLDependencies}
\includegraphics[height=70mm]{/part2/DLLDependencies.jpg}

Рис.2.4.1.2. Диаграмма зависимостей модулей программного комплекса \textbf{HsmmErrorSources.Generation}.
\end{center}

\subsection{Модуль моделей источников ошибок.}

Рассмотрим более подробно модуль \textbf{HsmmErrorSources.Models}. Как уже было сказано, этот модуль содержит классы, относящиеся к описанию, представлению и валидации моделей источников ошибок. Под описанием моделей здесь понимается их описание в виде объектов некоторого $C\sharp$-класса, под представлением --- предствление в виде JSON-объекта и необходимые для этого алгоритмы сериализации/десериализации, под валидацией --- проверка корректности заданных параметров модели с точки зрения консистентности и выполнения всех необходимых условий.

На рисунке \ref{fig:chapt2_ModelsHierarchyUML} приведена UML-диаграмма иерархии классов, программно описывающих модели источника ошибок.

\begin{center}\label{fig:chapt2_ModelsHierarchyUML}
\includegraphics[height=120mm]{/part2/ModelsHierarchyUML.jpg}

Рис.2.4.1.3. UML-диаграмма иерархии классов моделей источника ошибок.
\end{center}

Все поддерживаемые комплексом модели источников ошибок должны реализовывать интерфейс IHsmModel, определяющий единственный аттрибут Type, принимающий значения перечисления ModelType. Класс AbstractHsmModel представляет собой абстрактную реализацию интерфейса IHsmModel, содержащую общие для наследующих классов аттрибуты. Классы HsmFergusonModel и HsmQpModel наследуют от AbstractHsmModel и определяют специфичные аттрибуты скрытой полумарковской модели Фергюсона и скрытой полумарковской QP-модели соответственно.

В качестве представления модели в строковом виде выбрано представление в виде JSON-объектов. Выбор этого формата обусловлен популярностю такого представления и, как следствие, наличием удобных инструментов для осуществления сериализации/десериализации. В частности, в программном комплексе для задач сериализации/десериализации использован фреймворк с открытым исходым кодом Json.NET \cite{JsonNet}.

На рисунке \ref{fig:chapt2_ValidatorsHierarchyUML} приведена UML-диаграмма иерархии классов, программно реализующих валидацию моделей источников ошибок.

\begin{center}\label{fig:chapt2_ValidatorsHierarchyUML}
\includegraphics[height=120mm]{/part2/ValidatorsHierarchyUML.jpg}

Рис.2.4.1.4. UML-диаграмма иерархии классов валидаторов моделей источника ошибок.
\end{center}

Иерархия классов-валидаторов имеет схожую с иерархией моделей структуру. Все поддерживаемые комплексом валидаторы моделей источников ошибок должны реализовывать интерфейс IValidator, определяющий основной метод Validate(), а также методы получения списка ошибок GetErrors() и определения наличия ошибок HasErrors(). Предпологается, что валидатор представляет собой объект с состоянием. Класс AbstractHsmModelValidator представляет собой абстрактную параметризованную типом модели реализацию интерфейса IValidator, содержащую логику валидации общих параметров для скрытой полумаковской модели Фергюсона и скрытой полумарковской QP-модели. В частности, в нем валидируется согласованность размерностей задаваемых матриц и векторов, а также условия стохастичности. Классы HsmFergusonModelValidator и HsmQpModelValidator наследуют от AbstractHsmModelValidator и предназначены для реализации логики валидации специфичных аттрибутов скрытой полумарковской модели Фергюсона и скрытой полумарковской QP-модели соответственно. Так для скрытой полумарковской QP-модели здесь валидируются параметры, связанные с заданием распределения длин квазипериодов, такие как эталонная плотность, средняя вероятность ошибки в состоянии, проверяется выполнения условия адаптированности и условия согласования параметров (см. раздел \ref{chapt2_HSMQPN}). Для удобства создания объектов валидаторов нужного типа реализован класс HsmmValidatorFactory, метод CreateModelValidator() которого создает объект валидатора на основе информации о типе модели.

\subsection{Модуль генерации последовательностей ошибок.}

Рассмотрим теперь модуль генерации \textbf{HsmmErrorSources.Generation}. Этот модуль включает классы относящиеся к генерации последовательностей ошибок скрытыми полумарковскими моделями, релизованными в модуле \textbf{HsmmErrorSources.Models}. Логически все классы модуля \textbf{HsmmErrorSources.Generation} можно разделить на классы-генераторы потоков ошибок, генераторы случайных чисел и классы необходмые для запуска генерации.

На рисунке \ref{fig:chapt2_GeneratorsHierarchyUML} представлена UML-диаграмма иерархии классов, программно реализующих генераторы последовательностей ошибок.

\begin{center}\label{fig:chapt2_GeneratorsHierarchyUML}
\includegraphics[height=150mm]{/part2/GeneratorsHierarchyUML.jpg}

Рис.2.4.1.5. UML-диаграмма иерархии классов генераторов последовательностей ошибок.
\end{center}

Иерархия классов-генераторов аналогична иерархии моделей источников ошибок и валидаторов моделей источников ошибок из модуля \textbf{HsmmErrorSources.Models}. Все поддерживаемые комплексом генераторы последовательностей ошибок должны реализовывать интерфейс IGenerator, определяющий единственный метод Generate(), принимающий в качестве параметра длину последовательности ошибок и возвращая последовательность ошибок в виде списка целых чисел.

 Следует отдельно отметить выбор представления элементов поля Галуа в описываемой программной реализации. Предполагается, что элементы поля Галуа представляются в форме модифицированных логарифмов (подробнее см. раздел \ref{chapt1_digital_systems}).

 Таким образом, на уровне программной реализации элемент поля Галуа может быть представлен неотрицательным целым числом примитивного типа int.

 Абстрактный класс AbstractHsmModelGenerator, параметризованный типом модели источника ошибок, представляет собой базовую реализацию интерфейса IGenerator, содержащую логику общую для скрытой полумаковской модели Фергюсона и скрытой полумарковской QP-модели логику генерации последовательности ошибок. При генерации последовательности ошибок используется передаваемый в качестве параметра в конструктор объекта генератор случайных чисел. В классе AbstractHsmModelGenerator применяется паттерн объектно-ориентированного проектирования "фабричный метод", в соответствии с которым специфичные для частных реализаций участки логики вынесены в отдельные абстрактные методы. Различающимся участком логики является генерация частичной последовательности ошибок при выбранных состоянии и длительности. Классы HsmFergusonModelGenerator и HsmQpModelGenerator наследуют от AbstractHsmModelGenerator и реализуют этот участок логики согласно алгоритмам для скрытой полумарковской модели Фергюсона и скрытой полумарковской QP-модели соответственно. Для удобства создания объектов валидаторов нужного типа реализован класс HsmmGeneratorFactory, метод CreateModelGenerator() которого создает объект генератора на основе информации о типе модели и выбранном генераторе случайных чисел.

 Как уже упоминалось помимо генераторов последовательностей ошибок модуль \textbf{HsmmErrorSources.Generation} содержит реализации генераторов случайных чисел. В частности, в программном комплексе поддерживаются следующие три вида генераторов псевдо-случайных чисел: стандартный генератор псевдослучайных чисел в .NET, криптографический генератор случайных чисел, а так же самостоятельно реализованный генератор случайных чисел, основанный на алгоритме RC4 (Rivest cipher 4).

 Под стандартным генератором псевдослучайных чисел платформы .NET понимается реализация на основе класса Random \cite{Random}, в которой псевдослучайные числа выбираются с равной вероятностью из конечного набора чисел. Строго говоря, выбранные числа не являются случайными, поскольку выбираются с использованием математического алгоритма, однако они достаточно случайны для практического применения. Согласно документации текущая реализация класса Random основана на измененной версии алгоритма генерации случайных чисел Дональда E. Кнута \cite{Knuth}.

 Под криптографическим генератором случайных чисел понимается реализация на основе класса RNGCryptoServiceProvider \cite{RNGCryptoServiceProvider}, использующего функцию CryptGenRandom из Crypto API, включенного в Windows. В основе генератора лежит алгоритм, основанный на двух известных криптографических примитивах --- потоковом шифре RC4 и хэш-функции SHA-1 \cite{Dorrendorf}.

 Третий генератор случайных чисел представляет собой самостоятельную реализацию на языке $C\sharp$, использвующую в своей основе потоковый шифр RC4. Исходный код генератора можно найти в приложении 999.

 Для достижения единообразия с остальными сущностями в программном комплексе все поддерживаемые генераторы случайных чисел объединены единым интерфейсом IPseudoRandomNumberGenerator, единственный метод которого GetValue() возвращает следующее значение генератора. На UML-диаграмме \ref{fig:chapt2_PRNGGeneratorsHierarchyUML} представлены все три реализации этого интерфейса.

\begin{center}\label{fig:chapt2_PRNGGeneratorsHierarchyUML}
\includegraphics[height=80mm]{/part2/PRNGGeneratorsHierarchyUML.jpg}

Рис.2.4.1.6. UML-диаграмма иерархии классов генераторов случайных чисел.
\end{center}

