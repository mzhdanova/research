\section{Численные методы решения обратных задач на основе решения задачи оценивания} \label{chapt3_Inverse_Problem}
... Полученные выше (..? теоретические...) результаты позволяют решить обратную задачу для ..., т.е. есть поток ошибок, набор моделей, требуется подобрать наиболее подходящую модель для потока...В случае модели определенного вида (...предыдущие 3 раздела...) имеются "формульные результаты". Опишем особенности алгоритма реализации задачи оценивания (сегменты)... опишем алгоритм решения обратной задачи с учетом базы. Примеры (алгоритм работает), примеры (с выделением отрезков лучше), примеры (может выделять)... Может быть в этом разделе нет "реальных" \textbf{помех}.

$r_{\mathrm{mah}}$

\subsection{Алгоритм решения задачи оценивания}
-формально расписанный алгоритм вычисления вероятности по последовательности и модели

шаблоны, количество, длина

\textbf{\underline {Алгоритм.}}

\textbf{Вход:}

1) последовательность ошибок $O=O_1O_2 ... O_T$;

2) скрытая полумарковская $QP$-модель источников ошибок $\lambda$.

\textbf{Выход:}

Вероятность генерации последовательности $O$ моделью $\lambda$.

\textbf{Ход работы:}

\textit{\underline {Шаг 1.}} Вычисляем $P(O | \lambda)$ по следующим формулам:
\begin{equation}\nonumber
\widetilde{P}[O_{1:T}]=\sum\limits_{j\in \mathcal{S}}\sum\limits_{d \in \mathcal{D}}\sum\limits_{d_1=1}^{d}P[O_{1:T-d_1}]\overline{\alpha}_{T-d_1+d}(j,d)b_{j,d}(O_{T-d_1+1}^{T-d_1+d}),
\end{equation}
где

\begin{equation}\nonumber
P[O_{1:t}]=\left\{\begin{array}{ll}
1, &t\leq 0,\\\sum\limits_{i\in \mathcal{S}}\sum\limits_{d\in \mathcal{D}}{P}[O_{1:t-d}]\overline{\alpha}_{t}(i,d)b_{i,d}(O_{t-d+1:t}),& t\in [1,T-d_1],\end{array}\right.
\end{equation}
\begin{equation}\nonumber
\overline{\alpha}_{t}(i,d)=\left\{
\begin{array}{ll}
\pi_i\rho_i(d), &t\leq 0,\\
\sum\limits_{i^\prime\in \mathcal{S}}\sum\limits_{d^\prime \in \mathcal{D}}\overline{\alpha}_{t-d}(i^\prime,d^\prime)\overline{b}_{i^\prime,d^\prime}(O_{t-d-d^\prime+1}^{t-d})
a_{i^\prime i} p_i(d), & t>0,
\end{array}\right.
\end{equation}
\begin{equation}
\nonumber
\overline{b}_{i^\prime,d^\prime}(O_{t-d-d^\prime+1}^{t-d})=\frac{b_{i^\prime,d^\prime}(O_{t-d-d^\prime+1}^{t-d})P[O_{1:t-d-d^\prime}]}{P[O_{1:t-d}]},
\end{equation}
и $b_{i,d}(O_{t-d+1:t})$ определяется в соответствии с леммой 2.

TODO: Написать, почему разбивать на сегменты хорошо.

\textbf{\underline {Усложненный алгоритм.}}

\textbf{Вход:}

1) последовательность ошибок $O=O_1O_2 ... O_T$;

2) скрытая полумарковская $QP$-модель источников ошибок $\lambda$.

3) длина сегмента разбиения $l\leq T$.

\textbf{Выход:}

Усредненная вероятность генерации последовательности $O$ моделью $\lambda$.

\textbf{Ход работы:}

\textit{\underline {Шаг 1.}} Разбиваем $O$ на $n=\lfloor T/l \rfloor$ частичных последовательностей $\{O_i\}_{i=1}^n$, где под $\lfloor T/l \rfloor$ будем понимать ближайшее целое число, не превосходящее $T/l$.

\textit{\underline {Шаг 2.}}
Для каждого сегмента $O_i$ из $n$ сегментов вычисляем вероятность $P(O_i|\lambda)=\widetilde{P}[O_i|\lambda]$ по формулам теоремы 2.

\textit{\underline {Шаг 3.}}
Вычисляем усредненную вероятность $P(O|\lambda)=\frac{\sum\limits_{i\in (0,n]}P(O_i|\lambda)}{n}$

 Заметим, что правильный выбор длины сегмента является важным условием корректной работы метода.
 При выборе длины сегмента нужно учитывать, что при слишком маленькой длине нельзя гарантировать точность метода, а при слишком боль-шой длине вероятности могут оказаться за пределом вычислительной точности.

 TODO: доработать рекомендации к выбору длины сегмента.

\subsection{Алгоритм решения обратной задачи} \label{sect3_2}

- Независимо от QP или Фергюсона надо описать алгоритм, позволяющий по последовательности и нескольким моделям выбирать наилучшую. В частности полно написать о проблеме выбора метрики (критерия).

- Без базы - набор. Алгоритм подбора некой абстрактной полумарковской модели

%- М.б. решение задачи о базовых моделях ошибок для ис опсапк. Принцип формирования базы.

Предположим, что построена база $\Lambda$ из скрытых макровских $QP$-моделей источников ошибок с различными параметрами, и имеется запись потока ошибок в реальном цифровом канале.

\begin{definition}
Под задачей идентификации СПМQP-модели будем понимать задачу подбора для некоторой последовательности такой модели из базы скрытых полумакровских $QP$-моделей, которая позволит генерировать последовательности ошибок, близкие к заданной в смысле выбранного критерия.
\end{definition}

О критериях.
Максимального правдоподобия,
"относительной вероятности",
логарифма "отностительной" вероятности,
максимума взаимной информации.

Пока из Рабинера (стр 102).

\begin{definition}
Критерием максимального правдоподобия называется критерий
$$\lambda_{max} = \arg\max\limits_{\lambda\in\Lambda} P(O | \lambda)$$
\end{definition}

\begin{definition}
Под критерием максимума относительной веротности между последовательностью $O$ и полным набором моделей $\Lambda$ будем называть критерий
$$\lambda_{max} =\arg\max\limits_{\lambda\in\Lambda} (\frac{P(\lambda, O_\mu)}{\sum\limits_{\lambda\in \Lambda}P(\lambda, O_\mu)}). $$
\end{definition}

\begin{definition}
Критерием максимума средней взаимной информации между последовательностью $O$ и полным набором моделей $\Lambda$ называется критерий
$$\lambda_{max} =\arg\max\limits_{\lambda\in\Lambda} [\log(P(\lambda, O_\mu) - \log \sum\limits_{\lambda\in \Lambda}P(\lambda, O_\mu))]= \arg\max\limits_{\lambda\in\Lambda} log(\frac{P(\lambda, O_\mu)}{\sum\limits_{\lambda\in \Lambda}P(\lambda, O_\mu)}). $$
\end{definition}

Рассмотрим метод, позволяющий подобрать параметры модели так, чтобы она наиболее точно отражала помеховую обстановку в моделируемом канале. Предлагаемый метод основан на вычислении для каждой модели $\lambda$ из базы $\Lambda$ вероятности $P(O | \lambda)$ наблюдения некоторой реально полученной последовательности ошибок $O=O_1O_2 ... O_T$ и сравнении этих вероятностей для разных моделей. В качестве искомой модели выберем модель, дающую наибольшую вероятность.

Рассмотрим следующий алгоритм подбора.

\textbf{\underline {Алгоритм.}}

\textbf{Вход:}

1) последовательность ошибок $O=O_1O_2 ... O_T$;

2) база $\Lambda$, составленная из скрытых полумарковских $QP$-моделей источников ошибок с различными параметрами.

\textbf{Выход:}

Модель $\lambda_{max}$, позволяющая наилучшим образом имитировать ошибку в канале.

\textbf{Ход работы:}

\textit{\underline {Шаг 1.}} Для  всех моделей $\lambda_m\in \Lambda$ вычисляем $P(O | \lambda_m)=\widetilde{P}_\lambda[O_{1:T}]$ по следующим формулам:
\begin{equation}\nonumber
\widetilde{P}[O_{1:T}]=\sum\limits_{j\in \mathcal{S}}\sum\limits_{d \in \mathcal{D}}\sum\limits_{d_1=1}^{d}P[O_{1:T-d_1}]\overline{\alpha}_{T-d_1+d}(j,d)b_{j,d}(O_{T-d_1+1}^{T-d_1+d}),
\end{equation}
где

\begin{equation}\nonumber
P[O_{1:t}]=\left\{\begin{array}{ll}
1, &t\leq 0,\\\sum\limits_{i\in \mathcal{S}}\sum\limits_{d\in \mathcal{D}}{P}[O_{1:t-d}]\overline{\alpha}_{t}(i,d)b_{i,d}(O_{t-d+1:t}),& t\in [1,T-d_1],\end{array}\right.
\end{equation}
\begin{equation}\nonumber
\overline{\alpha}_{t}(i,d)=\left\{
\begin{array}{ll}
\pi_i\rho_i(d), &t\leq 0,\\
\sum\limits_{i^\prime\in \mathcal{S}}\sum\limits_{d^\prime \in \mathcal{D}}\overline{\alpha}_{t-d}(i^\prime,d^\prime)\overline{b}_{i^\prime,d^\prime}(O_{t-d-d^\prime+1}^{t-d})
a_{i^\prime i} p_i(d), & t>0,
\end{array}\right.
\end{equation}
\begin{equation}
\nonumber
\overline{b}_{i^\prime,d^\prime}(O_{t-d-d^\prime+1}^{t-d})=\frac{b_{i^\prime,d^\prime}(O_{t-d-d^\prime+1}^{t-d})P[O_{1:t-d-d^\prime}]}{P[O_{1:t-d}]},
\end{equation}
и $b_{i,d}(O_{t-d+1:t})$ определяется в соответствии с леммой 2.

\textit{\underline {Шаг 2.}} Находим $P_{max}=\max\limits_{\lambda_m\in \Lambda}{P(O | \lambda_m)}$.

\textit{\underline {Шаг 3.}} Выбираем модель, такую что
 $$\lambda_{max}=\arg\max\limits_{\lambda_m\in \Lambda} P(O | \lambda_m) = \arg P_{max},$$
где функция $\arg$ возвращает модель $\lambda_{max}$, соответствующую максимальной вероятности $P_{max}$. Эту модель будем использовать для моделирования потока ошибок в канале.

Блок-схема для описанного алгоритма приведена на рис. 6.

\begin{center}
  % Requires \usepackage{graphicx}
  \includegraphics[width=160mm, height = 90mm]{/part3/ris_dip.pdf}\\
  Рис. 6. Блок-схема алгоритма подбора параметров.
\end{center}

\subsubsection{Пример}

Проиллюстрируем предложенный алгоритм на небольшом примере. Рассмотрим три СПМQP-модели с одинаковым выходным алфавитом ${\mathbb{F}}_2$:
1. $\bar{\lambda} =  \{\mathcal{\bar{S}};\mathcal{\bar{D}}; \bar{A}; \bar{\Pi}; \bar{p}(d); \bar{\rho}; \bar{\mu};\bar{M} ;{\mathbb{F}}_2;\bar{B} \},$ где
$$\bar{\Pi}=\{0.5,0.5\}; \bar{M}=0.1; \bar{\mu}=\{0.1,0.16\}.$$
\[ \bar{A}=\left(
  \begin{array}{cc}
    0.999 & 0.001 \\
    0.001 & 0.999 \\
  \end{array}
\right); \bar{B}=\left(
  \begin{array}{cc}
    0.8 & 0.2 \\
    0.3 & 0.7 \\
  \end{array}
\right); \]
\begin{equation}\nonumber
\begin{split}
&\bar{\rho}_0=\{0.004, 0.004, 0.007, 0.05, 0.24, 0.39, 0.24, 0.05, 0.007, 0.004, 0.004\},\\
&\bar{\rho}_1=\{0.67, 0.26, 0.05, 0.007, 0.006, 0.004, 0.001, 0.001, 0.001\},
\end{split}
\end{equation}
\[\bar{p}_0(d) =\left(
  \begin{tabular}{l|c}
    $10$ &$ 15$  \\
    \hline
    $0.1$ & $0.9$ \\
  \end{tabular}
    \right);
\bar{p}_1(d) =\left(
  \begin{tabular}{l|c}
    $9$ &$ 8$  \\
    \hline
    $0.5$ & $0.5$ \\
  \end{tabular}
    \right);
\]

2. $\hat{\lambda} =  \{\mathcal{\hat{S}};\mathcal{\hat{D}}; \hat{A}; \hat{\Pi}; \hat{p}(d); \hat{\rho}; \hat{\mu};\hat{M} ;{\mathbb{F}}_2;\hat{B} \},$ где
$$\hat{\Pi}=\{0.9,0.1\}; \hat{M}=0.1; \hat{\mu}=\{0.1,0.16\}.$$
\[ \hat{A}=\left(
  \begin{array}{cc}
    0.5 & 0.5 \\
    0.5 & 0.5 \\
  \end{array}
\right); \hat{B}=\left(
  \begin{array}{cc}
    0.993 & 0.007 \\
    0.007 & 0.993 \\
  \end{array}
\right); \]
\begin{equation}\nonumber
\begin{split}
&\hat{\rho}_0=\{0.001, 0.001, 0.001, 0.001, 0.001, 0.007, 0.007, 0.007, 0.007,\\& 0.007, 0.04, 0.05, 0.24, 0.39, 0.24\},\\
&\hat{\rho}_1=\{0.001, 0.001, 0.001, 0.004, 0.006, 0.007, 0.05, 0.26, 0.67\},
\end{split}
\end{equation}
\[\hat{p}_0(d) =\left(
  \begin{tabular}{l|c}
    $10$ &$ 20$  \\
    \hline
    $0.9$ & $0.1$ \\
  \end{tabular}
    \right);
\hat{p}_1(d) =\left(
  \begin{tabular}{l}
    $9$  \\
    \hline
    $1$  \\
  \end{tabular}
    \right);
\]
3. $\tilde{\lambda} =  \{\mathcal{\tilde{S}};\mathcal{\tilde{D}}; \tilde{A}; \tilde{\Pi}; \tilde{p}(d); \tilde{\rho}; \tilde{\mu};\tilde{M} ;{\mathbb{F}}_2;\tilde{B} \},$
где
$$\tilde{\Pi}=\{0.2,0.8\}; \tilde{M}=0.1; \tilde{\mu}=\{0.2,0.2\}.$$
\[ \tilde{A}=\left(
  \begin{array}{cc}
    0.75 & 0.25 \\
    0.25 & 0.75 \\
  \end{array}
\right); \tilde{B}=\left(
  \begin{array}{cc}
    0.5 & 0.5 \\
    0.5 & 0.5 \\
  \end{array}
\right); \]
\begin{equation}\nonumber
\begin{split}
&\tilde{\rho}_0=\{0.495, 0.002, 0.001, 0.001, 0.001, 0.495, 0.001, 0.001, 0.001, 0.002\},\\
&\tilde{\rho}_1=\{0.002, 0.001, 0.001, 0.495, 0.495, 0.001, 0.001, 0.001, 0.001, 0.002\},
\end{split}
\end{equation}
\[\tilde{p}_0(d) =\left(
  \begin{tabular}{l|c}
    $13$ &$ 18$  \\
    \hline
    $0.3$ & $0.7$ \\
  \end{tabular}
    \right);
\tilde{p}_1(d) =\left(
  \begin{tabular}{l|c}
    $22$ &$ 15$  \\
    \hline
    $0.8$ & $0.2$ \\
  \end{tabular}
    \right);
\]
Проведем следующий эксперимент. Используя каждую из моделей $\bar{\lambda}$, $\hat{\lambda}$, $\tilde{\lambda}$ в качестве генератора, сгенерируем три последовательности $O_{\bar{\lambda}}$, $O_{\hat{\lambda}}$,$O_{\tilde{\lambda}}$ длиной 5000 символов. Рассмотрим последовательность $\bar{\lambda}$. Для удобства вычислений разобьем ее на 10 сегментов по 500 символов и, используя формулы (), вычислим вероятность генерации моделью $\bar{\lambda}$ каждого из 10 сегментов, после чего усредним полученные значения и тем самым вычислим $P(\bar{\lambda}, O_{\bar{\lambda}})$. Аналогичные вычисления проведем для всех пар $(\lambda, O_\mu)$, где $\lambda, \mu \in \{\bar{\lambda}, \hat{\lambda}, \tilde{\lambda}\}$. Полученные девять чисел $P(\lambda, O_\mu)$ приведем в таблице 1.

\begin{mtable}
Значения величины $P(\lambda, O_\mu)$ для рассматриваемого примера
\begin{center}
\begin{tabular}{|l|l|l|l|}
  \hline
  - & $O_{\bar{\lambda}}$ & $O_{\hat{\lambda}}$ & $O_{\tilde{\lambda}}$ \\
  \hline
  $\bar{\lambda}$ & $3.42E-57$
 & $1.67E-94$
 & $1.70E-137$ \\
  $\hat{\lambda}$ & $2.03E-90$ & $9.45E-49$ & $1.45E-211$ \\
  $\tilde{\lambda}$ & $7.85E-146$ & $5.08E-148$ & $2.26E-55$ \\
  \hline
\end{tabular}
\end{center}
\end{mtable}

Поставим задачу по таблице результатов выбрать модель, наиболее соответствующую каждой из последовательностей. В качестве критерия можно выбрать критерий максимального правдоподобия, то есть выбирать модель дающую наибольшую вероятность $P(\lambda, O_\mu)$. Если пользоваться этим критерием, видно, что для каждой из последовательностей модель, которой она была сгенерирована, дает наибольшую вероятность. Однако, зачастую удобно использовать и другие критерии. Например, выбирать модель, дающую максимальную относительную вероятность, то есть $\frac{P(\lambda, O_\mu)}{\sum\limits_{\lambda\in \Lambda}P(\lambda, O_\mu)}$. В некоторых случаях удобнее сравнивать не сами относительные вероятности, а их логарифмы. Таким образом, выбирается модель, дающая на последовательности максимум $log(\frac{P(\lambda, O_\mu)}{\sum\limits_{\lambda\in \Lambda}P(\lambda, O_\mu)})$. Этот критерий носит название критерия максимума взаимной информации. Для рассматриваемого примера значения этой величины приведены в таблице:

\begin{mtable}
Значения величины $log(\frac{P(\lambda, O_\mu)}{\sum\limits_{\lambda\in \Lambda}P(\lambda, O_\mu)})$ для рассматриваемого примера
\begin{center}
\begin{tabular}{|l|l|l|l|}
  \hline
  - & $O_{\bar{\lambda}}$ & $O_{\hat{\lambda}}$ & $O_{\tilde{\lambda}}$ \\
  \hline
  $\bar{\lambda}$ & $0$ & $-45.75372824$ & $-82.12334112$ \\
  $\hat{\lambda}$ & $-33.22597501$ & $0$ & $-156.1912406$ \\
  $\tilde{\lambda}$ & $-88.63917916$ & $-99.26931236$ & $0$ \\
  \hline
\end{tabular}
\end{center}
\end{mtable}

Из таблицы видно, что критерий максимума взаимной информации в нашем примере позволяет сделать такой же вывод, что и критерий максимального правдоподобия.
Замечание. При выборе длины сегмента нужно учитывать, что при слишком маленькой длине нельзя гарантировать точность метода, а при слишком большой длине вероятности могут оказаться за пределом вычислительной точности.
\section{Комплекс программ для решения задачи подбора скрытой полумарковской модели источника ошибок}\label{chapt3_Implementation}
\subsection{Структура программного комплекса}
м б вспомогательные
\subsection{Программная реализация алгоритма решения задачи оценивания для скрытых полумарковских моделей}
\subsection{Программная реализация алгоритма решения задачи подбора скрытой полумарковской модели источника ошибок}
